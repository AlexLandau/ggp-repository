<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>GGP.org - Games</title>
    <meta name="description" content="General game playing is about playing games that you've never seen before. View hundreds of different games here." />
    <link href="//fonts.googleapis.com/css?family=Roboto:300,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//www.ggp.org/viewer/bellerophon.css" />    
    <script type='text/javascript' src='//www.ggp.org/scripts/Analytics.js'></script>
    <script type="text/javascript" src="//www.ggp.org/viewer/bellerophonHeader.js"></script>
  </head>
  <body>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/ResourceLoader.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/UserInterface.js'></script>

    <div class="header" id="header"></div>
    <br>
    <center>
    <table id="game_table" cellspacing=15>
    <tr>
      <th align=left>Game Name</th>    
      <th align=left>Version</th>
      <th align=left>Roles</th>
      <th align=left>Metadata</th>
      <th align=left>Rulesheet</th>
      <th align=left>Stylesheet</th>
      <th align=left>Interface</th>
      <th align=left>Description</th>
      <th align=left>Curator</th>
    </tr>
    </table>
    </center>

    <script type="text/javascript" language="javascript">
      var repoName = window.location.pathname.split("/")[1];
    
      var repoTitle = UserInterface.toTitle(repoName);
      if (repoTitle == "Base") repoTitle = "Base Repository";
      if (repoTitle == "Dresden") repoTitle = "Dresden GGPServer";
      if (repoTitle == "Stanford") repoTitle = "Stanford Gamemaster";      
      generateHeader(document.getElementById('header'), "Games - " + repoTitle, "");
  
      var repo_prefix = '//games.ggp.org/' + repoName + '/';
      var game_table = document.getElementById("game_table");

      var games_listing = ResourceLoader.load_json(repo_prefix + 'games/');
      games_listing.sort();
      for (var i = 0; i < games_listing.length; i++) {
        var gameRow = document.createElement('tr');      
        gameRow.id = "gamerow_" + games_listing[i];
        gameRow.innerHTML = "<td><b><tt>[" + games_listing[i] + "]</tt></b></td> <td colspan=8>Loading game information...</td>";
        game_table.appendChild(gameRow);
      }
      for (var i = 0; i < games_listing.length; i++) {
        ResourceLoader.load_raw_async_with_timeout(repo_prefix + 'games/' + games_listing[i] + '/', curry(addGameToListing, games_listing[i]), 60000);
      }

      function curry(f, x) {
        return function(z) { return f(x, z); };
      }
      function addGameToListing(key, metadata) {
        var meta = JSON.parse(metadata);
        var gameRow = document.getElementById("gamerow_" + key);

        var theHTML = "<td><b>";
        if (meta.gameName) {
          theHTML += meta.gameName;
        } else {
          theHTML += "<tt>[" + key + "]</tt>";
        }
        theHTML += "</b></td> <td>"
        if (meta.version != null) theHTML += "v" + meta.version;
        theHTML += "</td> <td>";      
        if (meta.numRoles) theHTML += meta.numRoles;
        theHTML += "</td> <td>";
        theHTML += "<a href='//games.ggp.org/" + repoName + "/games/" + key + "/'>Metadata</a>";
        theHTML += "</td> <td>";
        if (meta.rulesheet) theHTML += "<a href='//games.ggp.org/" + repoName + "/games/" + key + "/" + meta.rulesheet + "'>Rulesheet</a>";
        theHTML += "</td> <td>";
        if (meta.stylesheet) theHTML += "<a href='//games.ggp.org/" + repoName + "/games/" + key + "/" + meta.stylesheet + "'>Stylesheet</a>";
        theHTML += "</td> <td>";
        if (meta.user_interface) theHTML += "<a href='//games.ggp.org/" + repoName + "/games/" + key + "/" + meta.user_interface + "'>Interface</a>";
        theHTML += "</td> <td>";
        if (meta.description) theHTML += "<a href='//games.ggp.org/" + repoName + "/games/" + key + "/" + meta.description + "'>Description</a>";
        theHTML += "</td> <td>";
        if (meta.curator) theHTML += "" + meta.curator;
        theHTML += "</td>";

        gameRow.innerHTML = theHTML;
      }    
    </script>
  </body>
</html>